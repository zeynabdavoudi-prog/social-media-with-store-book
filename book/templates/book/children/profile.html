{% extends 'book/parent/base.html' %} {% load static %} {% block title %}Profile
{% endblock %} {% block head %}
<link rel="stylesheet" href="{% static 'css/children/editprofile.css' %}" />
<link rel="stylesheet" href="{% static 'css/children/tweet.css' %}" />
<link rel="stylesheet" href="{% static 'css/children/profile.css' %}" />
{% endblock %}
{% block body %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<div class="container mb-3 mt-3 p-4 container-profile" style="">
{#show profile , background#}
<div class=" card" style="position: relative">
  {% if profile.background_image_profile %}
  <img
    src="{{ profile.background_image_profile.url }}"
    class="card-img background_image_profile"
    alt="..."
  />
  {% else %}
  <div class="background_image_profile" style="background-color: #1c7293"></div>
  {% endif %} {% if profile.file %}
  <img src="{{ profile.file.url }}" class="profile_file" />
  {% else %}
  <span><i class="bi bi-person-circle profile_icon"></i></span>
  {% endif %}
</div>


  <div class="row text-color align-items-center"  >
{#  information right#}

    <div class="col-lg-8 mt-5 col-profile overflow-y-auto order-2 order-lg-1" >
    {% if  variable == 'f' %}
{#        navbar#}
      <div class="row border-bottom sticky-top" >
  <nav class="navbar nav-background-color " >
    <div class="container-fluid justify-content-around fw-bold">
      <a
        class="nav-link active"
        aria-current="page"
        href="{% url 'book:user_profile_nav' user.id 1 %}"
        >توییت</a
      >
      <a class="nav-link" href="{% url 'book:user_profile_nav' user.id 2 %}"
        >پسند</a
      >
      <a class="nav-link" href="{% url 'book:user_profile_nav' user.id 3 %}"
        >کتاب های فروشی</a
      >
      <a class="nav-link" href="{% url 'book:user_profile_nav' user.id 4 %}"
        >کتاب های پیشنهادی</a
      >
    </div>
  </nav>
</div>
{#    show tweet#}

{% if id == 1 or id == 2 %}
<div class=" mt-3 row justify-content-center">
    {% if not tweets %}
        <div class="row text-center">

            <p class="">چیزی برای نمایش وجود ندارد</p>
        </div>
    {% endif %}
    <div class="col-md-9">
      {% for tweet in tweets %}
      <div
        class="card mb-3 m-auto"
        style="max-width: 680px"

      >
        <div class="row g-0">
          {% if tweet.id in tweet_with_image %}
          <div class="col-4 col-md-4">
            <div class="img-fluid rounded-start">
              <div
                id="carouselExampleIndicators"
                class="carousel slide"
                data-bs-ride="carousel"
              >
                <div class="carousel-inner">
                  {% for image in image_tweet %} {% if tweet.id == image.tweet.id %}


                  <div class="carousel-item active">
                    <img
                      src="{{ image.file.url }}"
                      class="d-block w-100 border_image"
                      alt="..."
                      style="height: 205px"
                    />
                  </div>

                  {% endif %} {% endfor %}
                </div>
              </div>
            </div>
          </div>
          <div class="col-8 col-md-8">
            <div class="card-body color-text-card">
              <div class="card-title d-flex">
                {% for profile in profile_all %} {% if profile.user == tweet.user%}
                {% if profile.file %}
                <a
                  class="title_a"
                  href="{% url 'book:user_profile' tweet.user.id %}"
                  ><img
                    class="img-fluid img-profile-img_tweet me-2"
                    src="{{ profile.file.url }}"
                  /><span class="span_title"
                    >{{ profile.user.username }}</span
                  ></a
                >
                {% else %}
                <a
                  class="title_a"
                  href="{% url 'book:user_profile' tweet.user.id %}"
                  ><i class="bi bi-person img-profile-i_tweet me-2 border px-2 border-2" style="border-radius: 50%"></i
                  ><span class="span_title"
                    >{{ profile.user.username }}</span
                  ></a
                >
                {% endif %} {% endif %} {% endfor %} {% if tweet.updated_at %}
                <p class="ms-auto">{{ tweet.updated_at| timesince }}</p>
                {% else %}
                <p class="ms-auto">{{ tweet.created_at| timesince }}</p>
                {% endif %}
              </div>
              <div class="card-text font-text">
                <a
                  style="text-decoration: none; color: inherit"
                  href="{% url 'book:tweet_detail' tweet.slug tweet.id %}"
                  >{{ tweet.body | truncatewords:20 }}</a
                >
              </div>
              <div class="card-text d-flex">
                {% for tag in tweet.tags.all %} {% if tag|wordcount != 0 %}
                <a
                  style="text-decoration: none"
                  href="{% url 'book:search_tag' tag.id %}"
                  ><small class="small_text">#{{ tag }}</small></a
                >
                {% endif %}{% endfor %}
              </div>
            </div>
          </div>
          {% else %}
          <div class="col-md-12">
            <div class="card-body color-text-card">
              <div class="card-title d-flex">
                {% for profile in profile_all %} {% if profile.user == tweet.user%}
                {% if profile.file %}
                <a
                  class="title_a"
                  href="{% url 'book:user_profile' tweet.user.id %}"
                  ><img
                    class="img-fluid img-profile-img_tweet me-2"
                    src="{{ profile.file.url }}"
                  /><span class="span_title"
                    >{{ profile.user.username }}</span
                  ></a
                >
                {% else %}
                <a
                  class="title_a"
                  href="{% url 'book:user_profile' tweet.user.id %}"
                  ><i class="bi bi-person img-profile-i_tweet me-2 border px-2 border-2"style="border-radius: 50%"></i
                  ><span class="span_title"
                    >{{ profile.user.username }}</span
                  ></a
                >
                {% endif %} {% endif %} {% endfor %} {% if tweet.updated_at %}
                <p class="ms-auto">{{ tweet.updated_at| timesince }}</p>
                {% else %}
                <p class="ms-auto">{{ tweet.created_at| timesince }}</p>
                {% endif %}
              </div>
              <div class="card-text mt-3 font-text">
                <a
                  style="text-decoration: none; color: inherit"
                  href="{% url 'book:tweet_detail' tweet.slug tweet.id %}"
                  >{{ tweet.body | truncatewords:40 }}</a
                >
              </div>
              <div class="card-text d-flex">
                {% for tag in tweet.tags.all %} {% if tag|wordcount != 0 %}
                <a
                  style="text-decoration: none"
                  href="{% url 'book:search_tag' tag.id %}"
                  ><small class="small_text">#{{ tag }}</small></a
                >
                {% endif %}{% endfor %}
              </div>
            </div>
          </div>
          {% endif %}
        </div>
      </div>
        <hr >
      {% endfor %}
    </div>
  </div>
{% endif %}
{#show salebook        #}
{% if id == 3 %}
    {% if  sale_books.count == 0 %}
        <div class="row text-center">
            <p>چیزی برای نمایش وجود ندارد</p>
        </div>

    {% endif %}
    <div class="row mt-5 justify-content-center">
        {% for book in sale_books %}

            <div class="col-md-6 col-xxl-4 mb-3 ">
                <div class="card text-color m-auto" style="width: 16.5rem ;height: 18rem">
                    <a href="{% url 'book:detail_salebook' book.id %}"><img src="{{ book.photo.url }}" class="card-img-top" alt="..." style="height: 14rem"></a>
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <h5 class="card-title">{{ book.name_book | truncatewords:'3' }}</h5>
                        <h4>{{ book.price }} تومان</h4>

                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% endif %}
{#show recommended book        #}
 {% if id == 4 %}
     {% if recommended_book.count == 0 %}
         <div class="row text-center">
            <p>چیزی برای نمایش وجود ندارد</p>
         </div>
     {% endif %}
     <div class="row mt-5 justify-content-center">
        {% for book in recommended_book %}

            <div class="col-md-6 col-xxl-4 mb-3 ">
                <div class="card text-color m-auto" style="width: 16.5rem ;height: 20rem">
                    {% if book.photo %}
                        <img src="{{ book.photo.url }}" class="card-img-top" alt="..." style="height: 14rem">
                        {% else %}

                        <div class="card-img-top" style="height: 14rem;background-color: #1C7293" ></div>
                    {% endif %}
                    <div class="card-body ">
                        <a style="color: inherit;text-decoration: none"  href="{% url 'book:detail_recommendedbookuser' book.id %}"><h5 class="card-title fw-bold text-center">نام کتاب:{{ book.book_name | truncatewords:'4' }}</h5></a>
                        <h4 class="text-center"> نام نویسنده:{{ book.author | truncatewords:'4'}}</h4>

                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
 {% endif %}
  {% elif variable == 't' %}
        <h4 class="text-danger text-center mt-5">شما از دنبال کردن {{ profile.user.username }}و مشاهده توییت های ان منع شده اید. </h4>
{% endif %}
    </div>

{#information left#}
 <div
      class="col-lg-4 py-3 order-1"
      style="margin-top: 4.5rem"
    >
    {% if request.user.id != user.id %}
        <div


                class="dropdown  dropdown-center  dropdown-position"
              >
                <button

                  class="btn dropdown-toggle "
                  type="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                ></button>
                <ul
                  class="dropdown-menu dropdown-menu-end border-1 border-black"
                >
                  <li>
                    <a class="dropdown-item fw-bold border-bottom" href="#"
                       data-bs-toggle="modal"
                      data-bs-target="#exampleModalBlock"
                      ><span> <i class="bi bi-ban me-2"></i>مسدود سازی کاربر</span></a
                    >
                  </li>
                  <li>
                    <a class="dropdown-item fw-bold" href="{% url 'book:report_user' user.id %}"><span><i class="bi bi-flag me-2"></i>گزارش کردن توییت</span></a>
                  </li>
                </ul>
              </div>
        {% endif %}
      <div class="row text-center">


        <h2 class="fw-bold">{{ user.first_name }} {{ user.last_name }}</h2>

        <h4 class="opacity-75 ">{{ user.username }}</h4>

      </div>
        {% if  variable == 'f'  %}
      <div class="row mt-3">
        <div class="d-flex justify-content-around text-center">
          <div>{{ tweet.count }}<br />تعداد توییت</div>
          <div><button
                  id="count_following"
              style="background-color: inherit; border: none;color: inherit"
              data-bs-toggle="modal"
              data-bs-target="#exampleModalfollowing"
            >
              {{ following.count }}</button><br />دنبال شونده</div>
          <div>
            <button
                    id="count_follower"
              style="background-color: inherit; border: none;color: inherit"
              data-bs-toggle="modal"
              data-bs-target="#exampleModalfollower"
            >
              {{ follower.count }}</button
            ><br />دنبال کننده
          </div>
        </div>
      </div>
      <div class="row mt-4">
        <div class="d-flex justify-content-evenly">
          <span
            ><i class="bi bi-calendar3 me-2" style="color: #1c7293"></i>تاریخ
            پیوستن:{{ user.date_joined|date:"d-m-Y" }}</span
          >
          {% if profile.date_of_birth %}
          <span
            ><i class="bi bi-balloon-fill me-1" style="color: hotpink"></i
            >متولد:{{ profile.date_of_birth|date:"d-m-Y" }}</span
          >
          {% endif %}
        </div>
      </div>
      {% if profile.Location %}
      <div class="row text-center mt-3">
        <span
          ><i class="bi bi-geo-alt-fill me-1" style="color: darkgreen"></i
          >مکان:{{ profile.Location }}</span
        >
      </div>
      {% endif %} {% if profile.bio %}
      <div class="row mt-4 text-center">
        <span class="h5"
          ><i class="bi bi-pencil-square me-1" style="color: #1c7293"></i>{{ profile.bio }}
          </span
        >
      </div>
      {% endif %} {% if profile.user.id == request.user.id %}
      <div class="row justify-content-center mt-5">
        <a
          style="border-radius: 5rem;width: 8rem"
          class="btn btn-primary  fw-bold me-3"
          href="{% url 'book:edit_profile' request.user.id %}"
          >ویرایش نمایه</a
        >
        <a style="border-radius: 5rem;width: 10rem"
          class="btn btn-primary  fw-bold" href="{% url 'book:recommendedbookuser' %}">کتاب های پیشنهادی من</a>
      </div>

      {% endif %} {% if request.user.id in relation_list and request.user.id != user.id %}

      <div class="row justify-content-center mt-3">
        <a
           id="relation{{ user.id }}"
          style="border-radius: 5rem"
          class="btn btn-primary w-50 fw-bold"
          onclick="Relation('{{ user.id }}')"
          >دنبال شده</a
        >
      </div>

      {% endif %} {% if request.user.id not in relation_list and request.user.id != user.id and is_block == False %}


      <div class="row justify-content-center mt-3">
        <a
          id="relation{{ user.id }}"
          style="border-radius: 5rem"
          class="btn btn-outline-primary w-50 fw-bold"
          onclick="Relation('{{ user.id }}')"
          >دنبال کردن
        </a>
      </div>
      {% endif %}
     {% if request.user.id not in relation_list and request.user.id != user.id and is_block == True %}

      <div class="row justify-content-center mt-3" id="insertblock">
        <a id="Block"
          data-bs-toggle="modal" data-bs-target="#exampleModal"
          style="border-radius: 5rem"
          class="btn btn-primary w-50 fw-bold bg-danger"

          >مسدود شده
        </a>
      </div>
      {% endif %}
        {% endif %}
    </div>
  </div>
    </div>
{#     relation ajax #}
        <script>
          function Relation(user_id){

              var element = document.getElementById('relation'+ user_id );
              var count = document.getElementById('count_follower');
              {#var element_remove = document.getElementById('remove_request_user');#}
              $.get(`/relation/${user_id}`).then(response =>{
                  if (response['response'] === 'follow'){

                      element.innerText = 'دنبال شده'
                      count.innerText = Number(count.innerText) + 1
                      const element_request = document.getElementById('request_user');
                      $(element_request).toggleClass('ajax_element');
                      const element_remove_request = document.getElementById('remove_request');
                      $(element_remove_request).toggleClass('ajax_element');
                      $(element).removeClass('btn-outline-primary');
                      $(element).addClass('btn-primary')


                  }
                  else {

                      element.innerText = 'دنبال کردن'
                      count.innerText = Number(count.innerText) - 1


                      const element_request = document.getElementById('request_user');
                      $(element_request).toggleClass('ajax_element');
                      const element_remove_request = document.getElementById('remove_request');
                      $(element_remove_request).toggleClass('ajax_element');
                      $(element).removeClass('btn-primary');
                      $(element).addClass('btn-outline-primary')








                  }
              })
          }
        </script>
{#      modal show follower    #}
<div
  class="modal fade"
  id="exampleModalfollower"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
  data-bs-backdrop="static"
>
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-4 fw-bold" id="exampleModalLabel">
          دنبال کننده ها:
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        {% for relation in relation_list %} {% for profile_a in profile_all %}
        {% if profile_a.user.id == relation and relation != request.user.id and relation not in list_block_requestuser_id %}{% if profile_a.file %}

        <span class="d-flex align-items-center">
          <a href="{% url 'book:user_profile' profile_a.user.id %}">
            <img
              src="{{  profile_a.file.url }}"
              class="img-fluid img-profile-img_modal"
          /></a>
          <a
            href="{% url 'book:user_profile' profile_a.user.id %}"
            class="ms-2 a-modal"
            >{{ profile_a.user.username }}</a
          >

          {% if request.user.id == profile.user.id and relation in  relation_following %}


          <a
                  id="relation{{ relation }}"
            onclick="Relation{{ relation }}('{{ relation }}','{{ request.user.id }}','{{ profile.user.id }}','{{ profile_a.user.id }}')"
            class="btn btn-primary ms-auto align-self-start"
            >دنبال شده</a
          >

          {% endif %} {% if request.user.id != profile.user.id and relation in following_request_user_list and relation != request.user.id%}


          <a
              id="relation{{ relation }}"
            onclick="Relation{{ relation }}('{{ relation }}','{{ request.user.id }}','{{ profile.user.id }}','{{ profile_a.user.id }}')"
            class="btn btn-primary ms-auto align-self-start"
            >دنبال شده</a
          >

          {% endif %} {% if request.user.id == profile.user.id and relation not in relation_following %}

          <a
              id="relation{{ relation }}"
            onclick="Relation{{ relation }}('{{ relation }}','{{ request.user.id }}','{{ profile.user.id }}','{{ profile_a.user.id }}')"
            class="btn btn-outline-primary ms-auto align-self-start"
            >دنبال کردن</a
          >
          {% endif %} {% if request.user.id != profile.user.id and relation not in following_request_user_list and relation != request.user.id%}

          <a
              id="relation{{ relation }}"
            onclick="Relation{{ relation }}('{{ relation }}','{{ request.user.id }}','{{ profile.user.id }}','{{ profile_a.user.id }}')"
            class="btn btn-outline-primary ms-auto align-self-start"
            >دنبال کردن</a
          >
          {% endif %}
        </span>

        {% if profile_a.bio %}
        <span class="modal-span opacity-75"
          >{{ profile_a.bio | truncatewords:4 }}</span
        >
        {% endif %}
        <hr />
        {% else %}

        <span class="d-flex align-items-center"
          ><a href="{% url 'book:user_profile' profile_a.user.id %}">
            <i class="bi bi-person-circle img-profile-i_modal"></i
          ></a>
          <a
            href="{% url 'book:user_profile' profile_a.user.id %}"
            class="ms-2 a-modal"
            >{{ profile_a.user.username }}</a
          >
          {% if request.user.id == profile.user.id and relation in  relation_following %}


          <a
              id="relation{{ relation }}"
            onclick="Relation{{ relation }}('{{ relation }}','{{ request.user.id }}','{{ profile.user.id }}','{{ profile_a.user.id }}')"
            class="btn btn-primary ms-auto align-self-start"
            >دنبال شده</a
          >

          {% endif %} {% if request.user.id != profile.user.id and relation in following_request_user_list and relation != request.user.id%}


          <a
              id="relation{{ relation }}"
            onclick="Relation{{ relation }}('{{ relation }}','{{ request.user.id }}','{{ profile.user.id }}','{{ profile_a.user.id }}')"
            class="btn btn-primary ms-auto align-self-start"
            >دنبال شده</a
          >

          {% endif %} {% if request.user.id == profile.user.id and relation not in relation_following %}

          <a
              id="relation{{ relation }}"
            onclick="Relation{{ relation }}('{{ relation }}','{{ request.user.id }}','{{ profile.user.id }}','{{ profile_a.user.id }}')"
            class="btn btn-outline-primary ms-auto align-self-start"
            >دنبال کردن</a
          >
          {% endif %} {% if request.user.id != profile.user.id and relation not in following_request_user_list and relation != request.user.id%}

          <a
              id="relation{{ relation }}"
            onclick="Relation{{ relation }}('{{ relation }}','{{ request.user.id }}','{{ profile.user.id }}','{{ profile_a.user.id }}')"
            class="btn btn-outline-primary ms-auto align-self-start"
            >دنبال کردن</a
          >
          {% endif %}
        </span>
        {% if profile_a.bio %}
        <span class="modal-span opacity-75"
          >{{ profile_a.bio | truncatewords:4 }}</span
        >
        {% endif %}
        <hr />

        {% endif %}

{#             relation ajax #}
        <script>
          function Relation{{ relation }}(relation,request_user_id,profile_user_id,profile_a_user_id){

              var element = document.getElementById('relation{{ relation }}');
              var count = document.getElementById('count_following');


              $.get(`/relation/${relation}`).then(response =>{
                  if (response['response'] === 'follow'){
                      element.innerText = 'دنبال شده'
                      $(element).removeClass('btn-outline-primary');
                      $(element).addClass('btn-primary')
                      if (request_user_id === profile_user_id) {
                          count.innerText = Number(count.innerText) + 1
                          const add_html=document.getElementById('ajax'+profile_a_user_id);
                           $(add_html).removeClass('ajax-block');




                      }

                  }
                  else {
                      element.innerText = 'دنبال کردن'
                      $(element).removeClass('btn-primary');
                      $(element).addClass('btn-outline-primary')
                      if (request_user_id === profile_user_id){
                          count.innerText = Number(count.innerText) - 1
                          const remove_add_html=document.getElementById('ajax'+profile_a_user_id);
                           $(remove_add_html).addClass('ajax-block');
                          {#remove_add_html.remove();#}
                          const remove_html=document.getElementById('remove'+profile_a_user_id);
                          remove_html.remove();

                      }

                  }
              })
          }
        </script>

        {% endif %}
{#            ajax add request user#}
        {% if profile_a.user.id == relation and relation == request.user.id %}
            <span id="remove_request">
            {% if profile_a.file %}

            <span class="d-flex align-items-center">
          <a href="{% url 'book:user_profile' profile_a.user.id %}">
            <img
              src="{{  profile_a.file.url }}"
              class="img-fluid img-profile-img_modal"
          /></a>
          <a
            href="{% url 'book:user_profile' profile_a.user.id %}"
            class="ms-2 a-modal"
            >{{ profile_a.user.username }}</a
          >


        </span>
        {% if profile_a.bio %}
        <span class="modal-span opacity-75"
          >{{ profile_a.bio | truncatewords:4 }}</span
        >
        {% endif %}
        {% else %}
           <span class="d-flex align-items-center"
          ><a href="{% url 'book:user_profile' profile_a.user.id %}">
            <i class="bi bi-person-circle img-profile-i_modal"></i
          ></a>
          <a
            href="{% url 'book:user_profile' profile_a.user.id %}"
            class="ms-2 a-modal"
            >{{ profile_a.user.username }}</a
          >

        </span>
         {% if profile_a.bio %}
        <span class="modal-span opacity-75"
          >{{ profile_a.bio | truncatewords:4 }}</span
        >
        {% endif %}

        {% endif %}
            <hr>
         </span>
        {% endif %}

        {% endfor %} {% endfor %}
      {#            ajax add request user#}
        {% if request.user.id not in relation_list  %}
            {% for profile_a in profile_all %}
                {% if profile_a.user.id == request.user.id %}
                    <span  id="request_user" class="ajax_element">
            {% if profile_a.file %}
            <span class="d-flex align-items-center">
          <a href="{% url 'book:user_profile' profile_a.user.id %}">
            <img
              src="{{  profile_a.file.url }}"
              class="img-fluid img-profile-img_modal"
          /></a>
          <a
            href="{% url 'book:user_profile' profile_a.user.id %}"
            class="ms-2 a-modal"
            >{{ profile_a.user.username }}</a
          >


        </span>
        {% if profile_a.bio %}
        <span class="modal-span opacity-75"
          >{{ profile_a.bio | truncatewords:4 }}</span
        >
        {% endif %}
        {% else %}
           <span class="d-flex align-items-center"
          ><a href="{% url 'book:user_profile' profile_a.user.id %}">
            <i class="bi bi-person-circle img-profile-i_modal"></i
          ></a>
          <a
            href="{% url 'book:user_profile' profile_a.user.id %}"
            class="ms-2 a-modal"
            >{{ profile_a.user.username }}</a
          >

        </span>
         {% if profile_a.bio %}
        <span class="modal-span opacity-75"
          >{{ profile_a.bio | truncatewords:4 }}</span
        >
        {% endif %}
        {% endif %}
        </span>
                {% endif %}
            {% endfor %}
        {% endif %}
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-outline-secondary"
          data-bs-dismiss="modal"
        >
          close
        </button>
      </div>
    </div>
  </div>
</div>
{#      modal show following    #}
<div
  class="modal fade"
  id="exampleModalfollowing"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
  data-bs-backdrop="static"
>
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-4 fw-bold" id="exampleModalLabel">
          دنبال شده ها:
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body" id="modal-body">
        {% for relation in relation_following %} {% for profile_a in profile_all  %}
        {% if profile_a.user.id == relation and relation not in list_block_requestuser_id %}<span id="remove{{ profile_a.user.id }}">{% if profile_a.file %}

        <span class="d-flex align-items-center">
          <a href="{% url 'book:user_profile' profile_a.user.id %}">
            <img
              src="{{  profile_a.file.url }}"
              class="img-fluid img-profile-img_modal"
          /></a>
          <a
            href="{% url 'book:user_profile' profile_a.user.id %}"
            class="ms-2 a-modal"
            >{{ profile_a.user.username }}</a
          >

          {% if request.user.id == profile.user.id %}

          <a
                  id="RelationFollowing{{ relation }}"
             onclick="RelationFollowing{{ relation }}('{{ relation }}','{{ request.user.id }}','{{ profile.user.id }}')"
            class="btn btn-primary ms-auto align-self-start"
            >دنبال شده</a
          >

          {% endif %} {% if request.user.id != profile.user.id and relation in   following_request_user_list and relation != request.user.id%}


          <a
            id="RelationFollowing{{ relation }}"
             onclick="RelationFollowing{{ relation }}('{{ relation }}','{{ request.user.id }}','{{ profile.user.id }}')"
            class="btn btn-primary ms-auto align-self-start"
            >دنبال شده</a
          >

          {% endif %} {% if request.user.id != profile.user.id and relation not   in following_request_user_list and relation != request.user.id%}


          <a
            id="RelationFollowing{{ relation }}"
             onclick="RelationFollowing{{ relation }}('{{ relation }}','{{ request.user.id }}','{{ profile.user.id }}')"
            class="btn btn-outline-primary ms-auto align-self-start"
            >دنبال کردن</a
          >
          {% endif %}
        </span>

        {% if profile_a.bio %}
        <span class="modal-span opacity-75"
          >{{ profile_a.bio | truncatewords:4 }}</span
        >
        {% endif %}
        <hr />
        {% else %}

        <span class="d-flex align-items-center"
          ><a href="{% url 'book:user_profile' profile_a.user.id %}">
            <i class="bi bi-person-circle img-profile-i_modal"></i
          ></a>
          <a
            href="{% url 'book:user_profile' profile_a.user.id %}"
            class="ms-2 a-modal"
            >{{ profile_a.user.username }}</a
          >
          {% if request.user.id == profile.user.id %}

          <a
            id="RelationFollowing{{ relation }}"
             onclick="RelationFollowing{{ relation }}('{{ relation }}','{{ request.user.id }}','{{ profile.user.id }}')"
            class="btn btn-primary ms-auto align-self-start"
            >دنبال شده</a
          >

          {% endif %} {% if request.user.id != profile.user.id and relation in following_request_user_list and relation != request.user.id%}


          <a
            id="RelationFollowing{{ relation }}"
             onclick="RelationFollowing{{ relation }}('{{ relation }}','{{ request.user.id }}','{{ profile.user.id }}')"
            class="btn btn-primary ms-auto align-self-start"
            >دنبال شده</a
          >

          {% endif %} {% if request.user.id != profile.user.id and relation not in following_request_user_list and relation != request.user.id%}


          <a
            id="RelationFollowing{{ relation }}"
             onclick="RelationFollowing{{ relation }}('{{ relation }}','{{ request.user.id }}','{{ profile.user.id }}')"
            class="btn btn-outline-primary ms-auto align-self-start"
            >دنبال کردن</a
          >
          {% endif %}
        </span>
        {% if profile_a.bio %}
        <span class="modal-span opacity-75"
          >{{ profile_a.bio | truncatewords:4 }}</span
        >
        {% endif %}
        <hr />

        {% endif %}
            <script>
              function RelationFollowing{{ relation }}(relation,request_user_id,profile_user_id){

              var element = document.getElementById('RelationFollowing{{ relation }}');
              var count = document.getElementById('count_following');
              $.get(`/relation/${relation}`).then(response =>{
                  if (response['response'] === 'follow'){
                      element.innerText = 'دنبال شده'
                      $(element).removeClass('btn-outline-primary');
                      $(element).addClass('btn-primary');
                      if (request_user_id === profile_user_id) {
                          count.innerText = Number(count.innerText) + 1
                           const element_follower = document.getElementById('relation{{ relation }}');
                          element_follower.innerText='دنبال شده';
                          $(element_follower).removeClass('btn-outline-primary');
                          $(element_follower).addClass('btn-primary');

                      }
                  }
                  else {
                      if (request_user_id !== profile_user_id){
                      element.innerText = 'دنبال کردن'
                      $(element).removeClass('btn-primary');
                      $(element).addClass('btn-outline-primary');
                      }
                      if (request_user_id === profile_user_id){
                          const element_delete=document.getElementById('remove{{ relation }}')
                          element_delete.remove()
                          count.innerText = Number(count.innerText) - 1
                          const element_follower = document.getElementById('relation{{ relation }}');
                          element_follower.innerText='دنبال کردن';
                          $(element_follower).removeClass('btn-primary');
                          $(element_follower).addClass('btn-outline-primary');

                      }

                  }
              })
          }
        </script>
            </span>
        {% endif %} {% endfor %} {% endfor %}
{#        ajax add#}
        {% for relation in relation_list %} {% for profile_a in profile_all %}
        {% if profile_a.user.id == relation %}<span class="ajax-block" id="ajax{{ profile_a.user.id }}">{% if profile_a.file %}
            {{ ss }}
        <span class="d-flex align-items-center">
          <a href="{% url 'book:user_profile' profile_a.user.id %}">
            <img
              src="{{  profile_a.file.url }}"
              class="img-fluid img-profile-img_modal"
          /></a>
          <a
            href="{% url 'book:user_profile' profile_a.user.id %}"
            class="ms-2 a-modal"
            >{{ profile_a.user.username }}</a
          >




          <a
                 id="RelationFollowingAjax{{ relation }}"
            onclick="RelationFollowingAjax{{ relation }}('{{ relation }}','{{ request.user.id }}','{{ profile.user.id }}')"
            class="btn btn-primary ms-auto align-self-start"
            >دنبال شده</a
          >

        </span>

        {% if profile_a.bio %}
        <span class="modal-span opacity-75"
          >{{ profile_a.bio | truncatewords:4 }}</span
        >
        {% endif %}
        <hr />
        {% else %}

        <span class="d-flex align-items-center"
          ><a href="{% url 'book:user_profile' profile_a.user.id %}">
            <i class="bi bi-person-circle img-profile-i_modal"></i
          ></a>
          <a
            href="{% url 'book:user_profile' profile_a.user.id %}"
            class="ms-2 a-modal"
            >{{ profile_a.user.username }}</a
          >

          <a
              id="RelationFollowingAjax{{ relation }}"
            onclick="RelationFollowingAjax{{ relation }}('{{ relation }}','{{ request.user.id }}','{{ profile.user.id }}')"
            class="btn btn-primary ms-auto align-self-start"
            >دنبال شده</a
          >

        </span>
        {% if profile_a.bio %}
        <span class="modal-span opacity-75"
          >{{ profile_a.bio | truncatewords:4 }}</span
        >
        {% endif %}
        <hr />

        {% endif %}

{#             relation ajax #}
        <script>
              function RelationFollowingAjax{{ relation }}(relation,request_user_id,profile_user_id){

              var element = document.getElementById('RelationFollowingAjax{{ relation }}');
              var count = document.getElementById('count_following');
              $.get(`/relation/${relation}`).then(response =>{
                  if (response['response'] === 'follow'){
                      element.innerText = 'دنبال شده';
                      $(element).removeClass('btn-outline-primary');
                      $(element).addClass('btn-primary');
                      if (request_user_id === profile_user_id) {
                          count.innerText = Number(count.innerText) + 1
                          const element_follower = document.getElementById('relation{{ relation }}');
                          element_follower.innerText='دنبال شده';
                          $(element_follower).removeClass('btn-outline-primary');
                          $(element_follower).addClass('btn-primary');
                      }
                  }
                  else {
                      if (request_user_id !== profile_user_id){
                      element.innerText = 'دنبال کردن';
                      $(element).removeClass('btn-primary');
                      $(element).addClass('btn-outline-primary');
                      }
                      if (request_user_id === profile_user_id){
                          const element_delete=document.getElementById('ajax{{ relation }}');
                          $(element_delete).addClass('ajax-block');
                          count.innerText = Number(count.innerText) - 1
                          const element_follower = document.getElementById('relation{{ relation }}');
                          element_follower.innerText='دنبال کردن';
                          $(element_follower).removeClass('btn-primary');
                          $(element_follower).addClass('btn-outline-primary');
                      }

                  }
              })
          }
        </script>
        </span>
        {% endif %}

        {% endfor %} {% endfor %}


      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-outline-secondary"
          data-bs-dismiss="modal"
        >
          close
        </button>
      </div>
    </div>
  </div>
</div>

{#modal unblock#}
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5 fw-bold" id="exampleModalLabel"> مسدود سازی {{ profile.user.username }}رفع شود؟</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        کاربر میتواند شما را دنبال کند و توییت هایتان را مشاهده کند.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary2" data-bs-dismiss="modal">لغو درخواست</button>
        <a onclick="Block('{{ profile.user.id }}')" type="button" class="btn btn-secondary1">لغو انسداد </a>
      </div>
    </div>
  </div>
</div>

     {#unblock ajax #}
            <script>
              function Block(user_id){

                  var element = document.getElementById('Block')

                  $.get(`/block_user/${user_id}`).then(response =>{
                      if (response['response'] === 'unblock'){
                          element.remove();
                          const element_insert = document.getElementById('insertblock')
                          element_insert.insertAdjacentHTML('afterbegin',`
                         <a
          id="relation{{ user.id }}"
          style="border-radius: 5rem"
          class="btn btn-primary w-50 fw-bold"
          onclick="Relation('{{ user.id }}')"
          >دنبال کردن
        </a>`)
                          // بستن مدال
            $('#exampleModal').modal('hide');

                      }

                  })
              }
            </script>


<!-- Modal block user with dropdown -->
<div class="modal fade" id="exampleModalBlock" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5 fw-bold" id="exampleModalLabel">{{ profile.user.username }}مسدود شود؟</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        {{ profile.user.username }}دیگر نمیتواند شما را دنبال کند یا به شما پیام بفرستد و شما نیز توییت های ان را نخواهید دید
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary2" data-bs-dismiss="modal">لغو درخواست</button>
        <a type="button" class="btn btn-secondary1" href="{% url 'book:block_user' profile.user.id %}">مسدود سازی</a>
      </div>
    </div>
  </div>
</div>

{% endblock %}
